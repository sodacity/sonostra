<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonostra Level Editor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Roboto:wght@400;500;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <style>
        /* --- Base Setup & Theming (Borrowed from style.css) --- */
        :root {
            --background-color: #121212;
            --glass-bg: rgba(22, 22, 22, 0.8);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-color: #EAEAEA;
            --primary-color: #03A9F4;
            --secondary-color: #FF00FF;
            --success-color: #4CAF50;
            --danger-color: #F44336;
            --font-body: 'Roboto', sans-serif;
            --font-display: 'Orbitron', sans-serif;
            --font-title: 'Audiowide', cursive;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-body);
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 2rem;
        }

        /* --- Main Layout --- */
        .editor-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* --- Glass Card Style --- */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
        }

        h1, h2 {
            font-family: var(--font-title);
            text-align: center;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        /* --- Sequence Display --- */
        #sequence-display {
            min-height: 200px;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 10px;
            padding: 1rem;
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
        }

        .arrow-icon {
            width: 64px;
            height: 64px;
        }

        /* --- Controls --- */
        .control-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        
        .btn {
            padding: 0.85rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: var(--font-display);
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--primary-color);
            color: white;
            box-shadow: 0 0 10px var(--primary-color), 0 4px 15px rgba(3, 169, 244, 0.3);
        }
        .btn:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
        }
        .btn.btn-secondary {
             background: #444;
             box-shadow: none;
        }
        .btn.btn-danger {
            background: var(--danger-color);
            box-shadow: 0 0 10px var(--danger-color);
        }

        /* --- Output & Import --- */
        #output-sequence {
            width: 100%;
            height: 100px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-color);
            font-family: monospace;
            font-size: 1rem;
            padding: 0.5rem;
            resize: vertical;
        }
        
        .output-actions {
            display: flex;
            gap: 1rem;
        }
        .output-actions .btn {
            flex-grow: 1;
        }

        /* --- Sidebar Controls --- */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .form-group label {
            font-family: var(--font-display);
            font-weight: 700;
            color: #ccc;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1rem;
        }

        #toast-notification {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-family: var(--font-display);
            font-weight: 700;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            pointer-events: none;
        }
        #toast-notification.show {
            opacity: 1;
            transform: translate(-50%, -10px);
        }

        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- SVG Definitions for Arrows -->
    <svg width="0" height="0" style="position:absolute">
        <defs>
            <linearGradient id="grad-up" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" style="stop-color:#2979FF;" /><stop offset="100%" style="stop-color:#82B1FF;" /></linearGradient>
            <linearGradient id="grad-down" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#FF1744;" /><stop offset="100%" style="stop-color:#FF8A80;" /></linearGradient>
            <linearGradient id="grad-left" x1="100%" y1="0%" x2="0%" y2="0%"><stop offset="0%" style="stop-color:#7C4DFF;" /><stop offset="100%" style="stop-color:#B388FF;" /></linearGradient>
            <linearGradient id="grad-right" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#00E676;" /><stop offset="100%" style="stop-color:#B9F6CA;" /></linearGradient>
        </defs>
    </svg>

    <div class="editor-container">
        <div class="main-content">
            <div class="glass-card">
                <h1>Sequence Editor</h1>
                <div id="sequence-display"></div>
            </div>
            <div class="glass-card">
                <h2>Controls</h2>
                <div class="control-panel">
                    <button id="add-up" class="btn">Up</button>
                    <button id="add-down" class="btn">Down</button>
                    <button id="add-left" class="btn">Left</button>
                    <button id="add-right" class="btn">Right</button>
                </div>
            </div>
            <div class="glass-card">
                <h2>Output / Import</h2>
                <textarea id="output-sequence" placeholder="Your sequence array will appear here. You can also paste an array here and click 'Import'."></textarea>
                <br>
                <div class="output-actions">
                    <button id="copy-btn" class="btn">Copy Array</button>
                    <button id="import-btn" class="btn btn-secondary">Import from Text</button>
                    <button id="clear-btn" class="btn btn-danger">Clear</button>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <!-- *** START: NEW PLAYER STATS PANEL *** -->
            <div class="glass-card">
                <h2>Player Stats</h2>
                <div class="form-group">
                    <label for="player-level-input">Player Level (highestWave)</label>
                    <input type="number" id="player-level-input" value="0" min="0">
                </div>
                <br>
                <button id="save-stats-btn" class="btn">Save Stats to Browser</button>
            </div>
            <!-- *** END: NEW PLAYER STATS PANEL *** -->

            <div class="glass-card">
                <h2>Parameters</h2>
                <div class="form-group">
                    <label for="time-limit">Time Limit (ms)</label>
                    <input type="number" id="time-limit" value="10000" step="100">
                </div>
                <div class="form-group">
                    <label for="player-lives">Player Lives</label>
                    <input type="number" id="player-lives" value="3" min="1" max="10">
                </div>
                 <div class="form-group">
                    <label for="boss-attack">Boss Attack Test</label>
                    <select id="boss-attack">
                        <option value="none">None</option>
                        <option value="timer_burn">Timer Burn</option>
                        <option value="blur">Blur</option>
                        <option value="stealth">Stealth</option>
                        <option value="stagger">Stagger</option>
                        <option value="glyph_storm">Glyph Storm</option>
                        <option value="static_veil">Static Veil</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-notification"></div>

    <script>
        // --- DATA (Copied from script.js for consistency) ---
        const ARROW_SKIN_DATA = {
            'arrow_default': {
                'ArrowUp': `<svg class="arrow-icon" viewBox="0 0 100 100"><path class="arrow-bg" fill="url(#grad-up)" d="M50,0 L100,50 L85,65 L50,30 L15,65 L0,50 Z"></path><path class="arrow-shape" fill="rgba(255,255,255,0.8)" d="M50,15 L80,45 L68,57 L50,39 L32,57 L20,45 Z"></path></svg>`,
                'ArrowDown': `<svg class="arrow-icon" viewBox="0 0 100 100"><path class="arrow-bg" fill="url(#grad-down)" d="M50,100 L0,50 L15,35 L50,70 L85,35 L100,50 Z"></path><path class="arrow-shape" fill="rgba(255,255,255,0.8)" d="M50,85 L20,55 L32,43 L50,61 L68,43 L80,55 Z"></path></svg>`,
                'ArrowLeft': `<svg class="arrow-icon" viewBox="0 0 100 100"><path class="arrow-bg" fill="url(#grad-left)" d="M0,50 L50,0 L65,15 L30,50 L65,85 L50,100 Z"></path><path class="arrow-shape" fill="rgba(255,255,255,0.8)" d="M15,50 L45,20 L57,32 L39,50 L57,68 L45,80 Z"></path></svg>`,
                'ArrowRight': `<svg class="arrow-icon" viewBox="0 0 100 100"><path class="arrow-bg" fill="url(#grad-right)" d="M100,50 L50,100 L35,85 L70,50 L35,15 L50,0 Z"></path><path class="arrow-shape" fill="rgba(255,255,255,0.8)" d="M85,50 L55,80 L43,68 L61,50 L43,32 L55,20 Z"></path></svg>`
            }
        };

        // --- STATE ---
        let currentSequence = [];

        // --- DOM ELEMENTS ---
        const sequenceDisplay = document.getElementById('sequence-display');
        const outputTextArea = document.getElementById('output-sequence');
        const toast = document.getElementById('toast-notification');
        const playerLevelInput = document.getElementById('player-level-input'); // New
        const saveStatsBtn = document.getElementById('save-stats-btn'); // New

        // --- FUNCTIONS ---

        /**
         * Renders the current sequence array to the display panel.
         */
        function renderSequence() {
            sequenceDisplay.innerHTML = '';
            currentSequence.forEach(arrowKey => {
                sequenceDisplay.innerHTML += ARROW_SKIN_DATA.arrow_default[arrowKey];
            });
            updateOutputText();
        }

        /**
         * Updates the text area with the stringified array.
         */
        function updateOutputText() {
            outputTextArea.value = JSON.stringify(currentSequence);
        }

        /**
         * Adds an arrow to the sequence.
         * @param {string} arrowKey - The key of the arrow to add (e.g., 'ArrowUp').
         */
        function addArrow(arrowKey) {
            currentSequence.push(arrowKey);
            renderSequence();
        }
        
        /**
         * Clears the entire sequence.
         */
        function clearSequence() {
            currentSequence = [];
            renderSequence();
        }

        /**
         * Copies the content of the output text area to the clipboard.
         */
        function copyToClipboard() {
            outputTextArea.select();
            document.execCommand('copy');
            showToast('Copied to clipboard!');
        }

        /**
         * Tries to parse the text in the output area and render it as a sequence.
         */
        function importSequence() {
            try {
                const importedArray = JSON.parse(outputTextArea.value);
                if (Array.isArray(importedArray) && importedArray.every(item => ARROW_SKIN_DATA.arrow_default[item])) {
                    currentSequence = importedArray;
                    renderSequence();
                    showToast('Sequence imported successfully!');
                } else {
                    throw new Error('Invalid array content.');
                }
            } catch (error) {
                alert('Invalid array format! Please ensure you are pasting a valid array of arrow keys, e.g., ["ArrowUp", "ArrowDown"].');
                console.error("Import failed:", error);
            }
        }
        
        /**
         * Shows a temporary notification message.
         * @param {string} message - The text to display.
         */
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // --- NEW PLAYER STATS FUNCTIONS ---

        /**
         * Loads player data from localStorage and populates the input field.
         */
        function loadPlayerStats() {
            const saved = localStorage.getItem('sonostraPlayerData');
            if (saved) {
                const playerData = JSON.parse(saved);
                playerLevelInput.value = playerData.highestWave || 0;
            }
        }

        /**
         * Saves the updated player level to localStorage.
         */
        function savePlayerStats() {
            const saved = localStorage.getItem('sonostraPlayerData');
            let playerData = saved ? JSON.parse(saved) : {};

            const newLevel = parseInt(playerLevelInput.value, 10);
            if (isNaN(newLevel) || newLevel < 0) {
                alert("Please enter a valid, non-negative number for the level.");
                return;
            }

            playerData.highestWave = newLevel;
            localStorage.setItem('sonostraPlayerData', JSON.stringify(playerData));
            showToast(`Player level saved as ${newLevel}!`);
        }


        // --- EVENT LISTENERS ---
        document.getElementById('add-up').addEventListener('click', () => addArrow('ArrowUp'));
        document.getElementById('add-down').addEventListener('click', () => addArrow('ArrowDown'));
        document.getElementById('add-left').addEventListener('click', () => addArrow('ArrowLeft'));
        document.getElementById('add-right').addEventListener('click', () => addArrow('ArrowRight'));
        
        document.getElementById('clear-btn').addEventListener('click', clearSequence);
        document.getElementById('copy-btn').addEventListener('click', copyToClipboard);
        document.getElementById('import-btn').addEventListener('click', importSequence);
        
        saveStatsBtn.addEventListener('click', savePlayerStats); // New listener

        // --- INITIALIZATION ---
        renderSequence();
        loadPlayerStats(); // Load stats on page load
    </script>
</body>
</html>
